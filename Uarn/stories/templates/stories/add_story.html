{% extends "stories/base.html" %}
{% block content %}

<div class="container">
  <h1>Добавить историю</h1>

  <form method="post" class="story-form">
    {% csrf_token %}
    {{ form.as_p }}
    
    <div class="mb-3">
      <label for="id_tags_input">Теги</label>
      <input class="story-input" name="tags_input" id="id_tags_input"
             placeholder="Введите теги через запятую...">
    </div>

    <button type="submit" class="submit-btn">Опубликовать</button>
  </form>

  <a href="{% url 'stories:index' %}" class="back-link">← Вернуться на главную</a>
</div>

<!-- Tagify -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@yaireo/tagify/dist/tagify.css">
<script src="https://cdn.jsdelivr.net/npm/@yaireo/tagify"></script>

<script>
document.addEventListener('DOMContentLoaded', () => {
  const input = document.querySelector('#id_tags_input');
  const existingTags = [
    {% for tag in tags %}
      "{{ tag.name }}",
    {% endfor %}
  ];

  new Tagify(input, {
    whitelist: existingTags,
    dropdown: {
      enabled: 0,
      maxItems: 10,
      classname: "tags-look",
      fuzzySearch: true,
      position: "input",
      highlightFirst: true
    }
  });
});
</script>

{% endblock %}
